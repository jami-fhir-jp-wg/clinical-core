{
  "resourceType": "StructureDefinition",
  "id": "JP-AllergyIntolerance-eCS",
  "url": "http://jpfhir.jp/fhir/eClinicalSummary/StructureDefinition/JP_AllergyIntolerance_eClinicalSummary",
  "name": "JP_AllergyIntolerance_eCS",
  "title": "Core6 : JP_AllergyIntolerance_eCS",
  "status": "active",
  "date": "2023-05-27",
  "description": "診療情報コアサマリー用　AllergyIntoleranceリソース（アレルギー情報／薬剤禁忌）プロファイル",
  "fhirVersion": "4.0.1",
  "mapping": [
    {
      "identity": "rim",
      "uri": "http://hl7.org/v3",
      "name": "RIM Mapping"
    },
    {
      "identity": "w5",
      "uri": "http://hl7.org/fhir/fivews",
      "name": "FiveWs Pattern Mapping"
    },
    {
      "identity": "v2",
      "uri": "http://hl7.org/v2",
      "name": "HL7 v2 Mapping"
    }
  ],
  "kind": "resource",
  "abstract": false,
  "type": "AllergyIntolerance",
  "baseDefinition": "http://jpfhir.jp/fhir/core/StructureDefinition/JP_AllergyIntolerance",
  "derivation": "constraint",
  "differential": {
    "element": [
      {
        "id": "AllergyIntolerance",
        "path": "AllergyIntolerance",
        "short": "診療情報コアサマリーにおけるアレルギー情報／薬剤禁忌の格納に使用する",
        "definition": "診療情報コアサマリーにおけるアレルギー情報／薬剤禁忌の格納に使用する",
        "comment": "厚労省6情報などの運用において、薬剤禁忌情報かアレルギー情報かの区別はcategory要素がmedicationかそれ以外かによる。"
      },
      {
        "id": "AllergyIntolerance.contained",
        "path": "AllergyIntolerance.contained",
        "slicing": {
          "discriminator": [
            {
              "type": "profile",
              "path": "$this"
            }
          ],
          "rules": "open"
        },
        "min": 1
      },
      {
        "id": "AllergyIntolerance.contained:patient",
        "path": "AllergyIntolerance.contained",
        "sliceName": "patient",
        "short": "診療情報コアサマリーにおける患者情報をコンパクトに格納したPatientリソース",
        "definition": "診療情報コアサマリーにおける患者情報をコンパクトに格納したPatientリソース",
        "comment": "",
        "min": 1,
        "max": "1",
        "type": [
          {
            "code": "Patient",
            "profile": [
              "http://jpfhir.jp/fhir/eClinicalSummary/StructureDefinition/JP_Patient_eCS_Contained",
              "http://jpfhir.jp/fhir/core/StructureDefinition/JP_Patient"
            ]
          }
        ]
      },
      {
        "id": "AllergyIntolerance.contained:encounter",
        "path": "AllergyIntolerance.contained",
        "sliceName": "encounter",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "Encounter",
            "profile": [
              "http://jpfhir.jp/fhir/eClinicalSummary/StructureDefinition/JP_Encounter_OW_eCS_Contained",
              "http://jpfhir.jp/fhir/core/StructureDefinition/JP_Encounter"
            ]
          }
        ]
      },
      {
        "id": "AllergyIntolerance.contained:recorder",
        "path": "AllergyIntolerance.contained",
        "sliceName": "recorder",
        "min": 0,
        "max": "1",
        "type": [
          {
            "code": "Practitioner",
            "profile": [
              "http://jpfhir.jp/fhir/eClinicalSummary/StructureDefinition/JP_Practitioner_eCS_Contained",
              "http://jpfhir.jp/fhir/core/StructureDefinition/JP_Practitioner"
            ]
          }
        ]
      },
      {
        "id": "AllergyIntolerance.identifier",
        "path": "AllergyIntolerance.identifier",
        "slicing": {
          "discriminator": [
            {
              "type": "value",
              "path": "type"
            }
          ],
          "rules": "open"
        },
        "short": "当該リソースインスタンス（データ）に対して、施設内で当該システムにより割りふられる一意の識別子",
        "definition": "当該リソースインスタンス（データ）に対して、施設内で当該システムにより割りふられる一意の識別子",
        "comment": "当該施設内で当該リソースインスタンスに割り振られる一意の識別子があればそれを使用する。すくなくともひとつのidentifierは、その削除や更新が可能な論理キーとなれる、識別IDである必要がある。それ以外に追加で当該施設または別の施設が別のsystem値との組み合わせによる異なるidentifierを1個以上設定してもよい。\r\nSS-MIX2から生成する場合には、次のルールを参考に１伝票内の１項目を識別できるようにする。\r\nアプリケーション側のデータベースにおけるフィールド長の定義については、最低64バイトを確保すること。\r\n\r\n--- 参考（検査結果項目の場合） ---\r\n\r\n次の項目を順にセパレータ「_(アンダースコア)」で連結し、 identifier.value に設定する。グループ項目でない場合など、該当コード／番号がない場合はセパレータを連続で連結する。各コードはローカルコードを使用し、必ず設定できること。\r\n\r\n　１．ORC-2(依頼者オーダ番号)　SS-MIX2の15桁前ゼロ形式の番号\r\n\r\n　２．OBR-4(検査項目ID)　検査セットの識別コード\r\n\r\n　３．SPM-4(検体タイプ)\r\n\r\n　４．OBX-3(検査項目)\r\n\r\n　５．OBX-4(検査副ID)・・・オプション。必要に応じて使用。\r\n\r\n形式：[ORC-2]_[OBR-4]_[SPM-4]_[OBX-3]（_[OBX-4]）",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.identifier.id",
        "path": "AllergyIntolerance.identifier.id",
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.identifier.use",
        "path": "AllergyIntolerance.identifier.use",
        "short": "この識別子の設定・利用目的を表すコード。",
        "definition": "この識別子の設定・利用目的コード。当該施設やシステムにおける一意キーには 'official'を設定する。この要素が存在しない場合にもofficialとみなす。",
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.identifier.system",
        "path": "AllergyIntolerance.identifier.system",
        "short": "このidebtifierの番号体系を識別するurl",
        "definition": "このidentifierの番号体系を識別するurl",
        "comment": "identifier.useが'official'の場合には、http://jpfhir.jp/fhir/eClinicalSummary/医療機関識別ID/システム識別文字列/システムバージョン記号番号　（例）を設定する。システム識別文字列は、当該施設でこの識別子の一意性を確保できるシステム識別文字列、たとえばMEDEMR2023など。医療機関識別IDは原則として、数字1の後ろに都道府県番号2桁、施設区分1桁（医科：1、歯科：3、調剤：4）、 機関番号7桁を連結した11桁とする。このsystem値のもとでvalueに設定される値が意味的に一意であればよい。",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.identifier.value",
        "path": "AllergyIntolerance.identifier.value",
        "short": "システムのコンテキスト内で一意の識別子となるidentifierの値を設定。",
        "definition": "システムのコンテキスト内で一意の識別子となるidentifierの値を設定。",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.identifier.assigner",
        "path": "AllergyIntolerance.identifier.assigner",
        "comment": "当面、コア情報ではこの情報を記録しないが、記録する場合には display子要素だけとし、別のリソースへの参照をしない。（新たなcontainedリソースの記述を避けるため）"
      },
      {
        "id": "AllergyIntolerance.identifier:systemTypeA_AccessionID",
        "path": "AllergyIntolerance.identifier",
        "sliceName": "systemTypeA_AccessionID",
        "short": "リソースインスタンスごとに異なる安定したIDがインスタンス識別子として割りあてられたidentifier",
        "definition": "リソースインスタンスごとに異なる安定したIDがインスタンス識別子として割りあてられたidentifier。このidentifierにより特定の「１個だけの」リソースインスタンスをアクセスできる。",
        "comment": "６情報としてこのリソースインスタンスが送信される場合には、削除や更新処理時にキーとして指定されるIDとして、systemTypeA_AccessionID、systemTypeB_PlacerID、systemTypeB_FillerIDのいずれかのタイプのidentifierのひとつが必須である。２つ以上あってはいけない。",
        "min": 0,
        "max": "1"
      },
      {
        "id": "AllergyIntolerance.identifier:systemTypeA_AccessionID.type",
        "path": "AllergyIntolerance.identifier.type",
        "min": 1,
        "patternCodeableConcept": {
          "coding": [
            {
              "code": "ACSN",
              "system": "http://terminology.hl7.org/CodeSystem/v2-0203"
            }
          ]
        },
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.identifier:systemTypeA_AccessionID.type.coding.system",
        "path": "AllergyIntolerance.identifier.type.coding.system",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.identifier:systemTypeA_AccessionID.type.coding.code",
        "path": "AllergyIntolerance.identifier.type.coding.code",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.identifier:systemTypeB_PlacerID",
        "path": "AllergyIntolerance.identifier",
        "sliceName": "systemTypeB_PlacerID",
        "short": "オーダ番号など、ひとつのオーダIDのもとに発行されたリソースインスタンスを一括してアクセスするためにインスタンス識別子として割りあてられたidentifier",
        "definition": "オーダ番号など、ひとつのIDのもとに発行されたリソースインスタンスを一括してアクセスするためにインスタンス識別子として割りあてられたidentifier。このidentifierにより一括して「複数の」「同時に削除や更新がなされる」リソースインスタンスをアクセスできる。",
        "comment": "systemTypeB_PlacerIDとsystemTypeB_FillerIDは厳密に区別する必要はない。６情報としてこのリソースインスタンスが送信される場合には、削除や更新処理時にキーとして指定されるIDとして、systemTypeA_AccessionID、systemTypeB_PlacerID、systemTypeB_FillerIDのいずれかのタイプのidentifierのひとつが必須である。２つ以上あってはいけない。",
        "min": 0,
        "max": "1"
      },
      {
        "id": "AllergyIntolerance.identifier:systemTypeB_PlacerID.type",
        "path": "AllergyIntolerance.identifier.type",
        "min": 1,
        "patternCodeableConcept": {
          "coding": [
            {
              "code": "PLAC",
              "system": "http://terminology.hl7.org/CodeSystem/v2-0203"
            }
          ]
        },
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.identifier:systemTypeB_PlacerID.type.coding.system",
        "path": "AllergyIntolerance.identifier.type.coding.system",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.identifier:systemTypeB_PlacerID.type.coding.code",
        "path": "AllergyIntolerance.identifier.type.coding.code",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.identifier:systemTypeB_FillerID",
        "path": "AllergyIntolerance.identifier",
        "sliceName": "systemTypeB_FillerID",
        "short": "報告書番号や実施番号など、ひとつのIDのもとに発行されたリソースインスタンスを一括してアクセスするためにインスタンス識別子として割りあてられたidentifier",
        "definition": "報告書番号や実施番号など、ひとつのIDのもとに発行されたリソースインスタンスを一括してアクセスするためにインスタンス識別子として割りあてられたidentifier。このidentifierにより一括して「複数の」「同時に削除や更新がなされる」リソースインスタンスをアクセスできる。",
        "comment": "systemTypeB_PlacerIDとsystemTypeB_FillerIDは厳密に区別する必要はない。６情報としてこのリソースインスタンスが送信される場合には、削除や更新処理時にキーとして指定されるIDとして、systemTypeA_AccessionID、systemTypeB_PlacerID、systemTypeB_FillerIDのいずれかのタイプのidentifierのひとつが必須である。２つ以上あってはいけない。",
        "min": 0,
        "max": "1"
      },
      {
        "id": "AllergyIntolerance.identifier:systemTypeB_FillerID.type",
        "path": "AllergyIntolerance.identifier.type",
        "min": 1,
        "patternCodeableConcept": {
          "coding": [
            {
              "code": "FILL",
              "system": "http://terminology.hl7.org/CodeSystem/v2-0203"
            }
          ]
        },
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.identifier:systemTypeB_FillerID.type.coding.system",
        "path": "AllergyIntolerance.identifier.type.coding.system",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.identifier:systemTypeB_FillerID.type.coding.code",
        "path": "AllergyIntolerance.identifier.type.coding.code",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.clinicalStatus",
        "path": "AllergyIntolerance.clinicalStatus",
        "short": "臨床的状態のステータス。",
        "definition": "active | inactive | resolved のいすれか（現存、非現存、解消）system=http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical",
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.verificationStatus",
        "path": "AllergyIntolerance.verificationStatus",
        "short": "入力された臨床的状態に対する検証状況を示す。確からしさと考えられる。",
        "definition": "unconfirmed | confirmed | refuted | entered-in-error  のいずれか（未確認、確認ずみ、否定、エラー）　system=http://terminology.hl7.org/CodeSystem/allergyintolerance-verification",
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.type",
        "path": "AllergyIntolerance.type",
        "short": "副反応の生理的なメカニズムの種類（アレルギーによるものか不耐性によるものかどうか）",
        "definition": "記述する場合は、コード表：\"http://hl7.org/fhir/allergy-intolerance-type\" から　allergy | intolerance のいずれか（アレルギー反応、不耐性反応）",
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.category",
        "path": "AllergyIntolerance.category",
        "short": "特定された原因物質のカテゴリ。記述を可能な限り推奨する。",
        "definition": "コード表：\"http://hl7.org/fhir/allergy-intolerance-category\" から　food | medication | environment | biologic　のいずれか　（食物、医薬品、環境、生物学的）。薬剤禁忌情報の記述ではmedication 医薬品 を使用する。",
        "comment": "厚労省6情報などの運用において、薬剤禁忌の情報として格納する場合にはmedicationを格納し、かつ criticality要素=high すること。逆にcategory=medicatoin かつ criticality=high である場合には、受信側において薬剤禁忌の情報とみなされる。",
        "max": "1",
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.criticality",
        "path": "AllergyIntolerance.criticality",
        "short": "潜在的な臨床的危険性、致命度",
        "definition": "記述する場合は、コード表：\"http://hl7.org/fhir/allergy-intolerance-criticality\" から　low | high | unable-to-assess　のいずれか（低、高、評価不能）",
        "comment": "厚労省6情報などの運用において、薬剤禁忌の情報として格納する場合にはcategory要素にmedicationを格納し、かつ criticality要素=high すること。逆にcategory=medicatoin かつ criticality=high である場合には、受信側において薬剤禁忌の情報とみなされる。",
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.code",
        "path": "AllergyIntolerance.code",
        "short": "アレルギー・不耐反応の対象物の情報。アレルギー・不耐反応の対象物の情報。薬剤禁忌情報の場合には、医薬品情報のコード",
        "definition": "jp-coreで定めるallergy-substanceコード表のコードを使用を推奨する。コード化できない場合には、code.text のみで記述する。使用するコード表（推奨）：http://jpfhir.jp/fhir/core/CodeSystem/JP_JfagyFoodAllergen_CS 　（食物アレルギー）、http://jpfhir.jp/fhir/core/CodeSystem/JP_JfagyMedicationAllergen_CS　（医薬品アレルギー）、http://jpfhir.jp/fhir/core/CodeSystem/JP_JfagyNonFoodNonMedicationAllergen_CS　（その他のアレルギー）、薬剤禁忌情報の記述では、医薬品コードはYJコード、厚生労働省医薬品コード、同一般医薬品コード、HOT9コードなどを選べる。",
        "comment": "https://jami-fhir-jp-wg.github.io/jp-core-v1xpages/jpcore-r4/develop/StructureDefinition-jp-allergyintolerance.html#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85 の注意事項を参照のこと。またアレルギー情報はコードにより正確に表現することが困難であることが多いので、必ずcode.textにより文字列で記述すること。",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.code.coding",
        "path": "AllergyIntolerance.code.coding",
        "slicing": {
          "discriminator": [
            {
              "type": "value",
              "path": "system"
            }
          ],
          "rules": "open"
        },
        "max": "1",
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.code.coding:medication",
        "path": "AllergyIntolerance.code.coding",
        "sliceName": "medication",
        "min": 0,
        "max": "1",
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.code.coding:medication.system",
        "path": "AllergyIntolerance.code.coding.system",
        "min": 1,
        "fixedUri": "http://jpfhir.jp/fhir/core/CodeSystem/JP_JfagyMedicationAllergen_CS"
      },
      {
        "id": "AllergyIntolerance.code.coding:food",
        "path": "AllergyIntolerance.code.coding",
        "sliceName": "food",
        "min": 0,
        "max": "1",
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.code.coding:food.system",
        "path": "AllergyIntolerance.code.coding.system",
        "min": 1,
        "fixedUri": "http://jpfhir.jp/fhir/core/CodeSystem/JP_JfagyMedicationAllergen_CS"
      },
      {
        "id": "AllergyIntolerance.code.coding:nonFoodnonMedication",
        "path": "AllergyIntolerance.code.coding",
        "sliceName": "nonFoodnonMedication",
        "min": 0,
        "max": "1",
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.code.coding:nonFoodnonMedication.system",
        "path": "AllergyIntolerance.code.coding.system",
        "min": 1,
        "fixedUri": "http://jpfhir.jp/fhir/core/CodeSystem/JP_JfagyNonFoodNonMedicationAllergen_CS"
      },
      {
        "id": "AllergyIntolerance.code.text",
        "path": "AllergyIntolerance.code.text",
        "short": "アレルギー情報をフリーテキストで記述した内容",
        "min": 1,
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.patient",
        "path": "AllergyIntolerance.patient",
        "short": "患者情報",
        "definition": "患者情報への参照",
        "comment": "Containedリソースに含まれる患者リソースのid(identifierではなく)をリソース内で#を最初につけて参照する。（患者リソースのid を　123 とすると、　{\"reference\" : \"#123\" }のようになる。）",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "http://jpfhir.jp/fhir/eClinicalSummary/StructureDefinition/JP_Patient_eCS_Contained"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.encounter",
        "path": "AllergyIntolerance.encounter",
        "short": "この情報を記録したときの受診情報（入外区分など）",
        "definition": "この情報を記録したときの受診情報（入外区分など）を表すEncounterリソース（Containedリソース）への参照",
        "comment": "Containedリソースに含まれるEncounterリソースをリソース内で参照する。なくてもよい。",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "http://jpfhir.jp/fhir/eClinicalSummary/StructureDefinition/JP_Encounter_OW_eCS_Contained"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.onset[x]",
        "path": "AllergyIntolerance.onset[x]",
        "type": [
          {
            "code": "Period"
          }
        ]
      },
      {
        "id": "AllergyIntolerance.onset[x].start",
        "path": "AllergyIntolerance.onset[x].start",
        "short": "登録日またはこの状態の存在が開始した日"
      },
      {
        "id": "AllergyIntolerance.onset[x].end",
        "path": "AllergyIntolerance.onset[x].end",
        "short": "この状態がなくなった、無効になった日"
      },
      {
        "id": "AllergyIntolerance.recordedDate",
        "path": "AllergyIntolerance.recordedDate",
        "short": "この情報を記録した登録日",
        "definition": "この情報を記録した登録日",
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.recorder",
        "path": "AllergyIntolerance.recorder",
        "short": "この情報を記録した登録者",
        "definition": "登録者を表すPractitionerリソース（Containedリソース）への参照",
        "comment": "Containedリソースに含まれるPractitioner（登録者/医療者）リソースをこのリソース内で参照する。",
        "type": [
          {
            "code": "Reference",
            "targetProfile": [
              "http://jpfhir.jp/fhir/eClinicalSummary/StructureDefinition/JP_Practitioner_eCS_Contained"
            ]
          }
        ],
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.asserter",
        "path": "AllergyIntolerance.asserter",
        "comment": "当面、コア情報ではこの情報を記録しないが、記録する場合には display子要素だけとし、別のリソースへの参照をしない。（新たなcontainedリソースの記述を避けるため）",
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.lastOccurrence",
        "path": "AllergyIntolerance.lastOccurrence",
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.note",
        "path": "AllergyIntolerance.note",
        "max": "1",
        "mustSupport": true
      },
      {
        "id": "AllergyIntolerance.reaction",
        "path": "AllergyIntolerance.reaction",
        "max": "1",
        "mustSupport": true
      }
    ]
  }
}
